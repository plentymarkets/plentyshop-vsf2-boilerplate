{"version":3,"file":"index.js","sources":["../src/api/_utils/buildPaymentApiClient.ts","../src/api/_utils/buildApiClient.ts","../src/consts.ts","../src/serverExtensions/handleWebhook.ts","../src/serverExtensions/endpoints.ts","../src/api/exampleEndpoint/index.ts","../src/api/getSmartButtonOrder/index.ts","../src/index.server.ts"],"sourcesContent":["import axios from 'axios';\nimport { PaypalServerConfig } from 'src/types';\n\nexport function buildPaymentApiClient(config: PaypalServerConfig) {\n  const client = axios.create({\n    baseURL: config.api.url,\n    withCredentials: true\n  });\n\n  return client;\n}\n","import { createApiClient } from '@vue-storefront/plentymarkets-api';\n\nexport function buildApiClient(config: unknown) {\n  console.log('pp build api client');\n  return createApiClient(config);\n}\n","export const API_WEBHOOK_ENDPOINT = 'webhook';\nexport const LOGGER_PREFIX = '[VSF2Paypalplentymarkets]';\nexport const MALFORMED_PRICE_QUERY_STRING = 'malformed-price';\n","import { Logger } from '@vue-storefront/core';\nimport { Request, Response } from 'express';\nimport { LOGGER_PREFIX } from '../consts';\nimport { WebhookClient } from 'src/types';\n\nconst webhookHandler = () => {}; // TODO\n\nconst handleWebhook = (client: WebhookClient, config: any /** TODO */) => {\n  return async (request: Request, response: Response) => {\n    try {\n      const webhookHandlerResult = await webhookHandler();\n\n      return response.send(webhookHandlerResult);\n    } catch (err) {\n      Logger.error(LOGGER_PREFIX, err);\n    }\n\n    return response.send({});\n  };\n};\n\nexport default handleWebhook;\n","import handleWebhook from './handleWebhook';\nimport { Express } from 'express';\nimport { API_WEBHOOK_ENDPOINT } from '../consts';\nimport {\n  buildApiClient, // TODO: Creates plentymarkets API client\n  buildPaymentApiClient // TODO: Creates pp API client\n} from '../api/_utils';\n\nexport const endpointsExtension = {\n  name: 'endpointsExtension',\n\n  extendApp: (ctx: { app: Express, configuration: any }) => {\n    const config = ctx.configuration;\n\n    ctx.app.post(`/pp/${API_WEBHOOK_ENDPOINT}`, handleWebhook({\n      // Client might be different in your specific case\n      plentymarkets: buildApiClient(config),\n      pp: buildPaymentApiClient(config)\n    }, config));\n  }\n};\n","import { Logger } from '@vue-storefront/core';\nimport { LOGGER_PREFIX } from '../../consts';\nimport { PaypalIntegrationContext } from '../../types';\n\nconst exampleEndpoint = async (\n  context: PaypalIntegrationContext,\n  params: any\n): Promise<any> => {\n  // context.client.pp.sendIT()\n  try {\n    return Promise.resolve({});\n  } catch (err) {\n    Logger.error(`${LOGGER_PREFIX} ${err.message}`);\n    throw err;\n  }\n};\n\nexport async function createOrder(context: PaypalIntegrationContext, fundingSource: string) {\n  const url: URL = new URL('/rest/payment/payPal/smart_payment/create/' + fundingSource, context.config.api.url);\n  const { data } = await context.client.pp.get(url.href);\n\n  return data;\n}\n\nexport async function getSession(context: PaypalIntegrationContext, initialRestCall: boolean): Promise<any> {\n  console.log('getSession: ', context);\n  const url: URL = new URL('/rest/io/session/', context.config.api.url);\n\n  url.searchParams.set('initialRestCall', initialRestCall.toString());\n  const { data } = await context.client.pp.get(url.href);\n\n  console.log('get sess exampleEndpoint: ', data);\n\n  return {\n    user: data.data.customer,\n    basket: data.data.basket\n  };\n}\n\nexport default createOrder;\n","import { PaypalIntegrationContext } from '../../types';\n\nexport async function createOrder(context: PaypalIntegrationContext, foundingSource: string): Promise<string> {\n  const url: URL = new URL('/rest/payment/payPal/smart_payment/create/paylater/', context.config.api.url);\n\n  const { data } = await context.client.pp.post(url.href);\n\n  console.log('createOrder', data);\n\n  return data;\n}\n","/* istanbul ignore file */\nimport { apiClientFactory } from '@vue-storefront/core';\n\nimport {\n  buildApiClient,\n  buildPaymentApiClient\n} from './api/_utils';\nimport { endpointsExtension } from './serverExtensions/endpoints';\nimport getSession from './api/exampleEndpoint';\nimport {createOrder} from './api';\nimport { PaypalServerConfig } from './types';\n\nconst { createApiClient } = apiClientFactory<PaypalServerConfig, unknown>({\n  onCreate: (config: PaypalServerConfig) => {\n    return {\n      config,\n      client: {\n        plentymarkets: buildApiClient(config),\n        pp: buildPaymentApiClient(config)\n      }\n    };\n  },\n  extensions: [\n    endpointsExtension\n  ],\n  api: {\n    getSession,\n    createOrder\n  }\n});\n\nexport {\n  createApiClient\n};\n"],"names":["axios","createApiClient","Logger","createOrder","apiClientFactory","getSession"],"mappings":"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"}